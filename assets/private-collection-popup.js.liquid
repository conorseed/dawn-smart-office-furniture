document.addEventListener('DOMContentLoaded', function(){

  // setup vars
  const pcp = document.getElementById('pcp_main')
  if(!pcp) return;

  const pcpAccept = document.getElementById('pcp__accept')
  const pcpDecline = document.getElementById('pcp__decline')
  const storageName = 'pcp_{{ collection.id }}'

  // open the modal
  const openPcp = ()=>{
    pcp.style.display = "flex";
    pcp.focus()
  }
  // close the modal
  const closePcp = ()=>{
    pcp.style.display = "none";
  }

  // check if should open or not
  const check = localStorage.getItem(storageName)
  if (!check|| check < Date.now()){
    openPcp()
  }


  // trap focus inside modal
  pcp.addEventListener('keydown', function(e) {
    if (e.key === 'Tab') {

      // Get all focusable elements within the modal
      const focusableElements = pcp.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
      const firstElement = focusableElements[0];
      const lastElement = focusableElements[focusableElements.length - 1];

      if (e.shiftKey && document.activeElement === firstElement) {
        e.preventDefault();
        lastElement.focus();
      } else if (
        !e.shiftKey &&
        document.activeElement === lastElement
      ) {
        e.preventDefault();
        firstElement.focus();
      }
    }
  });

  // on accept
  pcpAccept.addEventListener('click', ()=>{
    localStorage.setItem(storageName, Date.now() + 30000)
    closePcp()
  })

  // on decline
  pcpDecline.addEventListener('click', ()=>{
    window.location = '{{ shop.url }}'
  })
  

})